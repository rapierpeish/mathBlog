---
title: 山脊线提取算法
categories: 几何算法
tags:
  - 几何算法
order: 3
createTime: 2026/01/29 12:36:00
permalink: /math/ap8zqscu/
---
# 几何理论

## 三次多项式拟合计算曲率

原论文使用隐函数方法计算曲面曲率，此处我为了贴合[[曲面曲率]]讲义，使用参数化方式计算曲面顶点的极大和极小曲率。

基本计算原理：使用三阶多项式 $z(u,v)$ 在局部标架下，对顶点 $v$ 的2阶领域拟合,计算出 $z$ 的Hessian矩阵(二阶导数)，其特征值和特征向量即为顶点的曲率极值 $k_{\max}, k_{\min}$ 和曲率方向。

在局部坐标系 $(u,v)$ 下，以点 $p$ 为原点，拟合曲面高度函数：
$$
z(u,v) = \frac12 \left( a u^2 + 2 b u v + c v^2 \right)
+ \frac16 \left( d u^3 + 3 e u^2 v + 3 f u v^2 + g v^3 \right)
$$

- 二阶系数 $(a,b,c)$ 决定 Hessian，用于计算 $k_{\max}, k_{\min}$；
- 三阶系数 $(d,e,f,g)$ 决定 Hessian 的导数场（三阶导数），用于计算曲率场变化的极值 $e_{\max}$。

使用最小二乘法解超静定方程：
$$
\mathbf z \approx A \cdot \mathbf c
$$
其中 $\mathbf c = [a, b, c, d, e, f, g]^T$。

> 这些计算是在局部标架下进行的
## Ridge Line和Valley line判断

在曲面上每一点 $p$，有两个主曲率 $k_{\max}, k_{\min}$，对应的主方向 $\mathbf t_{\max}, \mathbf t_{\min}$，其中 $k_{\max} \geq k_{\min}$。

Ridge line: 沿最大曲率方向 $\mathbf t_{\max}$，$k_{\max}$ 取得极大值的曲线
Valley line: 沿最大曲率方向 $\mathbf t_{\max}$，$k_{\max}$ 取得极小值的曲线。

判定条件依赖于方向导数 $e_{\max}$：
$$
e_{\max}(p) = \nabla k_{max}(p) \cdot \mathbf{t}_{max}(p)
$$

- $\nabla k_{max}(p)$是曲率场在*p*点在主方向的梯度
- $\mathbf{t}_{max}(p)$是*p*点的主方向

当 $e_{\max}=0$ 且满足二阶条件时，点 $p$ 在 *Ridge/Valley* 上。

# 顶点法线估计

一般计算Mesh顶点法线的方法：
- 拉普拉斯-贝尔特拉米算法
- PCA方法

#### 拉普拉斯-贝尔特拉米算法

拉普拉斯-贝尔特拉米算子通过邻域点的权重平均来估算顶点的法线。具体步骤如下：
- 对每个顶点，计算其邻域中所有相邻三角形的法线。
- 将相邻三角形的法线进行加权平均，权重通常由相邻三角形的面积或角度决定。

$$
\mathbf{n}_v = \sum_{T \in N(v)} \mathbf{n}_T \cdot \omega(T)
$$

其中：

- $\mathbf{n}_v$ 是顶点 $v$ 的法线。
- $N(v)$ 是顶点 $v$ 邻域中的所有三角形。
- $\mathbf{n}_T$ 是三角形 $T$ 的法线。
- $\omega(T)$ 是三角形 $T$ 的权重。

**优点**：能够平滑地计算法线，适用于复杂网格和具有不规则拓扑的网格。
**缺点**：计算量较大，尤其是在大型网格上，可能需要额外的优化。

#### PCA方法
主成分分析（PCA）方法通过计算网格顶点邻域的协方差矩阵来确定法线方向。PCA可以通过对邻域点进行降维处理，提取出最大变化的方向作为法线。

**优点**：计算速度较快，适合大规模数据。
**缺点**：局部噪声影响法线的准确性。

### 面法线的法线平滑
PCA方法容易受噪声影响，所以用PCA方法计算法线根据效果对法线做平滑处理。常见处理方式包括：

- **均值平滑**：通过对邻域法线进行简单的平均来平滑法线。
- **高斯平滑**：使用高斯核对法线进行平滑，减少噪声影响。
- **双边滤波**：结合空间和法线信息的双边滤波，用于消除噪声同时保持表面细节。

> 我在实现中使用的是拉普拉斯-贝尔特拉米，cot权重。




# 结果展示和分析
valley线追踪结果展示，红色为valley线
![](/docs/public/Pasted image 20250817221406.png)

论文valley线和Ridge线追踪结果，红色为valley线，蓝色为Ridge线
![](/docs/public/Pasted image 20250830181741.png)

## 论文不足
Valley line的追踪结果受网格拓扑结构影响比较大。在放大后，会发现很多零碎的，尖锐的线段。
我觉得在算法前处理阶段，可以使用局部Loop细分+各项同性重建算法，增加大曲率部分的网格密度。在算法后处理阶段，使用VR复形工具或者聚类算法，建立Vally line的拓扑空间。使用高斯结构约束方程，除掉尖锐的部分，然后使用B样条曲线重新插值。

![](/docs/public/Pasted image 20250830200840.png)

# 参考论文

1. Ridge-Valley Lines on Meshes via Implicit Surface Fitting. Yutaka Ohtake Alexander Belyaev Hans-Peter Seidel
2. Fast and Robust Detection of Crest Lines on Meshes. Shin Yoshizawa, Alexander Belyaev, Hans-Peter Seidel